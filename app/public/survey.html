<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>SURVEY</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="modal fade" id="myModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Your best match:</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="friendName"></p>
            <img id="friendImg" src="" height="200" />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>Survey Questions</h1>
      <hr />
      <h3>About You</h3>
      <div class="form-group">
        <label for="Name">Name (Required)</label>
        <input
          type="text"
          class="form-control"
          id="name"
          placeholder="Your Name"
        />
      </div>
      <div class="form-group">
        <label for="image">Link to Photo Image (Required)</label>
        <input
          type="text"
          class="form-control"
          id="image"
          placeholder="URL for your photo"
        />
      </div>
      <hr />
      <h3>Question #1</h3>
      <h4>I like to travel by Portal Gun.</h4>
      <div class="form-group">
        <select name="question1" id="question1">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #2</h3>
      <h4>I do my best work when I'm inebriated.</h4>
      <div class="form-group">
        <select name="question2" id="question2">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #3</h3>
      <h4>I am easily manipulated.</h4>
      <div class="form-group">
        <select name="question3" id="question3">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #4</h3>
      <h4>People tend to underestimate my intelligence.</h4>
      <div class="form-group">
        <select name="question4" id="question4">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #5</h3>
      <h4>I enjoy working with animals.</h4>
      <div class="form-group">
        <select name="question5" id="question5">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #6</h3>
      <h4>I have a fear of abandonment.</h4>
      <div class="form-group">
        <select name="question6" id="question6">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #7</h3>
      <h4>I am extremely insecure.</h4>
      <div class="form-group">
        <select name="question7" id="question7">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #8</h3>
      <h4>I have an inner strength.</h4>
      <div class="form-group">
        <select name="question8" id="question8">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #9</h3>
      <h4>I crave popularity among my peers.</h4>
      <div class="form-group">
        <select name="question9" id="question9">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #10</h3>
      <h4>I have a strong bond with my family.</h4>
      <div class="form-group">
        <select name="question10" id="question10">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <div class="btn btn-primary btn-block" id="submit">
        <h4>
          <span class="glyphicon glyphicon-question-sign"></span> Find a friend
        </h4>
      </div>
      <hr />
      <div>
        <a href="/api/friends">API Friends List</a>
        <span>|</span>
        <a href="https://github.com/stravis11/FriendFinder" target="_blank"
          >Github Repo</a
        >
      </div>
      <br />
    </div>

    <script type="text/javascript">
      let newUser = {};
      let bestFriend = {
        diff: 100,
        name: "",
        image: ""
      };

      $("#submit").on("click", () => {
        let userName = $("#name")
          .val()
          .trim();
        let imag = $("#image")
          .val()
          .trim();
        let ans1 = $("#question1")
          .val()
          .trim();
        let ans2 = $("#question2")
          .val()
          .trim();
        let ans3 = $("#question3")
          .val()
          .trim();
        let ans4 = $("#question4")
          .val()
          .trim();
        let ans5 = $("#question5")
          .val()
          .trim();
        let ans6 = $("#question6")
          .val()
          .trim();
        let ans7 = $("#question7")
          .val()
          .trim();
        let ans8 = $("#question8")
          .val()
          .trim();
        let ans9 = $("#question9")
          .val()
          .trim();
        let ans10 = $("#question10")
          .val()
          .trim();

        if (
          userName === "" ||
          imag === "" ||
          ans1 === "" ||
          ans2 === "" ||
          ans3 === "" ||
          ans4 === "" ||
          ans5 === "" ||
          ans6 === "" ||
          ans7 === "" ||
          ans8 === "" ||
          ans9 === "" ||
          ans10 === ""
        ) {
          alert("Please answer all the questions");
        } else {
          newUser = {
            name: userName,
            photo: imag,
            scores: [ans1, ans2, ans3, ans4, ans5]
          };

          findFriend(newUser.scores);

          setTimeout(postData, 1500);

          function postData() {
            $.post(
              { url: "/api/friends", contentType: "application/json" },
              JSON.stringify(newUser)
            );
          }

          $("#name").val("");
          $("#image").val("");
          $("#question1").val("");
          $("#question2").val("");
          $("#question3").val("");
          $("#question4").val("");
          $("#question5").val("");
          $("#question6").val("");
          $("#question7").val("");
          $("#question8").val("");
          $("#question9").val("");
          $("#question10").val("");
        }
      });

      function findFriend(scores) {
        $.get("/api/friends", friends => {
          let count = 0;
          let arrayLength = friends.length;

          for (var i = 0; i < arrayLength; i++) {
            calcScoreDiff(scores, friends[i]);
            count++;
          }

          if (count === arrayLength) {
            $("#friendName").text(bestFriend.name);
            $("#friendImg").attr("src", bestFriend.image);
            $("#myModal").modal("toggle");
          }
        });
      }

      function calcScoreDiff(user, friend) {
        let diff = 0;
        let count = 0;

        for (var i = 0; i < 10; i++) {
          diff += Math.abs(user[i] - friend.scores[i]);
          count++;
        }

        if (count === 10) {
          if (diff < bestFriend.diff) {
            bestFriend.diff = diff;
            bestFriend.name = friend.name;
            bestFriend.image = friend.photo;
          } else {
            return;
          }
        }
      }
    </script>
  </body>
</html>
