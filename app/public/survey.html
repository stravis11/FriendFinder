<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>SURVEY</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="modal fade" id="myModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Your best match:</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p id="friendName"></p>
            <img id="friendImg" src="" height="200" />
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <h1>Survey Questions</h1>
      <hr />
      <h3>About You</h3>
      <div class="form-group">
        <label for="Name">Name (Required)</label>
        <input
          type="text"
          class="form-control"
          id="name"
          placeholder="Your Name"
        />
      </div>
      <div class="form-group">
        <label for="image">Link to Photo Image (Required)</label>
        <input
          type="text"
          class="form-control"
          id="image"
          placeholder="URL for your photo"
        />
      </div>
      <hr />
      <h3>Question #1</h3>
      <h4>Question 1</h4>
      <div class="form-group">
        <select name="quest1" id="quest1">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #2</h3>
      <h4>Question 2</h4>
      <div class="form-group">
        <select name="quest2" id="quest2">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #3</h3>
      <h4>Question 3</h4>
      <div class="form-group">
        <select name="quest3" id="quest3">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #4</h3>
      <h4>Question 4</h4>
      <div class="form-group">
        <select name="quest4" id="quest4">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <h3>Question #5</h3>
      <h4>Question 5</h4>
      <div class="form-group">
        <select name="quest5" id="quest5">
          <option value="">Select an Option</option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>
      </div>
      <div class="btn btn-primary btn-block" id="submit">
        <h4>
          <span class="glyphicon glyphicon-question-sign"></span> Find a friend
        </h4>
      </div>
      <hr />
      <div>
        <a href="/api/friends">API Friends List</a>
        <span>|</span>
        <a href="https://github.com/stravis11/FriendFinder" target="_blank"
          >Github Repo</a
        >
      </div>
      <br />
    </div>

    <script type="text/javascript">
      let newUser = {};
      let bestFriend = {
        diff: 100,
        name: "",
        image: ""
      };

      $("#submit").on("click", () => {
        let userName = $("#name")
          .val()
          .trim();
        let imag = $("#image")
          .val()
          .trim();
        let ans1 = $("#quest1")
          .val()
          .trim();
        let ans2 = $("#quest2")
          .val()
          .trim();
        let ans3 = $("#quest3")
          .val()
          .trim();
        let ans4 = $("#quest4")
          .val()
          .trim();
        let ans5 = $("#quest5")
          .val()
          .trim();

        if (
          userName === "" ||
          imag === "" ||
          ans1 === "" ||
          ans2 === "" ||
          ans3 === "" ||
          ans4 === "" ||
          ans5 === ""
        ) {
          alert("Please fill in all fields");
        } else {
          newUser = {
            name: userName,
            photo: imag,
            scores: [ans1, ans2, ans3, ans4, ans5]
          };

          findFriend(newUser.scores);

          setTimeout(postData, 1500);

          function postData() {
            $.post(
              { url: "/api/friends", contentType: "application/json" },
              JSON.stringify(newUser)
            );
          }

          $("#name").val("");
          $("#image").val("");
          $("#quest1").val("");
          $("#quest2").val("");
          $("#quest3").val("");
          $("#quest4").val("");
          $("#quest5").val("");
        }
      });

      function findFriend(scores) {
        $.get("/api/friends", friends => {
          let count = 0;
          let arrayLength = friends.length;

          for (var i = 0; i < arrayLength; i++) {
            calcScoreDiff(scores, friends[i]);
            count++;
          }

          if (count === arrayLength) {
            $("#friendName").text(bestFriend.name);
            $("#friendImg").attr("src", bestFriend.image);
            $("#myModal").modal("toggle");
          }
        });
      }

      function calcScoreDiff(user, friend) {
        let diff = 0;
        let count = 0;

        for (var i = 0; i < 5; i++) {
          diff += Math.abs(user[i] - friend.scores[i]);
          count++;
        }

        if (count === 5) {
          if (diff < bestFriend.diff) {
            bestFriend.diff = diff;
            bestFriend.name = friend.name;
            bestFriend.image = friend.photo;
          } else {
            return;
          }
        }
      }
    </script>
  </body>
</html>
